#!/usr/bin/env bash

printf "\nPublishing PHPCS config...\n\n"

phpcs_filename=".phpcs.xml.dist"

if [ -f "$phpcs_filename" ]; then
  printf "$phpcs_filename already exists.\n"
else
  cp ${BIN_DIR}/../stubs/.phpcs.xml.dist $phpcs_filename
  printf "Created $phpcs_filename.\n"
fi

printf "\nChecking GitHub Action...\n\n"

gh_action_filename=".github/workflows/lint.yml"

if [ -f "$gh_action_filename" ]; then
  printf "$gh_action_filename already exists.\n"
else
  echo -n "Would you like a GitHub action added to this repo for running lints? (Y/n) "
  read addGitHubAction

  if [ "$addGitHubAction" != "${addGitHubAction#[Yy]}" ]; then
    printf "\nAdding GitHub Actions workflow...\n"

    mkdir -p .github/workflows
    cp ${BIN_DIR}/../stubs/github-actions/lint.yml $gh_action_filename

    read -p "Enter the name of your primary branch [main]: " primary_branch
    primary_branch=${primary_branch:-main}
    sed -i '' "s/YOUR_BRANCH_NAME/${primary_branch}/g" $gh_action_filename

    read -p "Enter your PHP version [8.1]: " php_version
    php_version=${php_version:-8.1}
    sed -i '' "s/YOUR_PHP_VERSION/${php_version}/g" $gh_action_filename

    printf "\nCreated $gh_action_filename.\n"
  else
    printf "\nSkipping GitHub Action.\n"
  fi
fi
